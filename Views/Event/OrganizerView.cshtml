@model Eventure_ASP.Models.EventViewModel

@{
    ViewData["Title"] = @Model.Event.Name;
}

<div class="container">
    <link rel="stylesheet" href="~/css/event.css" />

    <div class="header-container">
        <h1 class="header">@Model.Event.Name</h1>
        <button class="btn btn-primary" id="btnBack" onclick="window.history.back();">Back</button>
    </div>

    <form asp-action="Save" method="post">
        <input type="hidden" name="EventId" value="@Model.Event.Id" />
        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="eventName" class="form-label">Event Name:</label>
                    <input type="text" id="eventName" name="EventName" class="form-control" value="@Model.Event.Name" required />
                </div>

                <div class="mb-3">
                    <label for="eventLocation" class="form-label">Event Location:</label>
                    <input type="text" id="eventLocation" name="EventLocation" class="form-control" value="@Model.Event.Location" required />
                </div>

                <div class="mb-3">
                    <label for="eventDescription" class="form-label">Event Description:</label>
                    <textarea id="eventDescription" name="EventDescription" class="form-control" required>@Model.Event.Description</textarea>
                </div>
            </div>

            <div class="col">
                <div class="mb-3">
                    <label for="startDate" class="form-label">Event Start Date:</label>
                    <input type="date" id="startDate" name="StartDate" class="form-control" value="@Model.StartDate.ToString("yyyy-MM-dd")" required />
                </div>

                <div class="mb-3">
                    <label for="startTime" class="form-label">Event Start Time:</label>
                    <input type="time" id="startTime" name="StartTime" class="form-control" value="@Model.StartTime.ToString("HH:mm")" required />
                </div>

                <div class="mb-3">
                    <label for="endDate" class="form-label">Event End Date:</label>
                    <input type="date" id="endDate" name="EndDate" class="form-control" value="@Model.EndDate.ToString("yyyy-MM-dd")" required />
                </div>

                <div class="mb-3">
                    <label for="endTime" class="form-label">Event End Time:</label>
                    <input type="time" id="endTime" name="EndTime" class="form-control" value="@Model.EndTime.ToString("HH:mm")" required />
                </div>
            </div>
        </div>

        <h2>Ticket Types</h2>
        <ul class="ticket-list">
            @if (Model.TicketTypes != null && Model.TicketTypes.Any())
            {
                foreach (var ticket in Model.TicketTypes)
                {
                    <li id="ticket-@ticket.Id">
                        @ticket.Name - PHP @ticket.Price - Quantity: @ticket.Quantity
                        <button type="button" class="ml-6 btn btn-edit" data-id="@ticket.Id" data-name="@ticket.Name" data-price="@ticket.Price" data-quantity="@ticket.Quantity" data-bs-toggle="modal" data-bs-target="#editTicketModal">Edit</button>
                    </li>
                }
            }
            else
            {
                <li>No ticket types available.</li>
            }
        </ul>

        <button type="button" class="btn btn-add" id="btnAddTicketType">Add Ticket Type</button>

        <div class="btn-save-container">
            <button type="submit" class="btn btn-primary"> Save Event</button>
        </div>
    </form>
</div>

<!-- Modal for editing ticket types -->
<div class="modal fade" id="editTicketModal" tabindex="-1" aria-labelledby="editTicketModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTicketModalLabel">Edit Ticket Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editTicketForm">
                    <input type="hidden" id="editTicketId" name="TicketId" />
                    <div class="mb-3">
                        <label for="editTicketName" class="form-label">Ticket Name:</label>
                        <input type="text" id="editTicketName" name="TicketName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="editTicketPrice" class="form-label">Ticket Price:</label>
                        <input type="number" id="editTicketPrice" name="TicketPrice" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="editTicketQuantity" class="form-label">Quantity:</label>
                        <input type="number" id="editTicketQuantity" name="TicketQuantity" class="form-control" required />
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveEditTicket">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).on('click', '.btn-edit', function () {
        const ticketId = $(this).data('id');
        const ticketName = $(this).data('name');
        const ticketPrice = $(this).data('price');
        const ticketQuantity = $(this).data('quantity');

        $('#editTicketId').val(ticketId);
        $('#editTicketName').val(ticketName);
        $('#editTicketPrice').val(ticketPrice);
        $('#editTicketQuantity').val(ticketQuantity);
    });

</script>